<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script> 
</head>
<body>

<script type="text/javascript">

const orgs = {
  "Kirkon Ala-aste": {
    "langs": [
      "C64 Assembly",
      "BASIC"
    ],
    "tools": [
      "Commodore 64",
      "Windows"
    ]
  },
  "Kurikan Yläaste, Lukio": {
    "langs": [
      "Pascal",
      "Java",
      "JavaScript",
      "SQL"
    ],
    "tools": [
      "Windows",
      "Linux"
    ]
  },
  "Kurikan Kaupunki": {
    "langs": [],
    "tools": []
  },
  "Turvavartiointi M. Savela Ky": {
    "langs": [],
    "tools": []
  },
  "Tampere University of Technology": {
    "langs": [
      "C++",
      "Java",
      "J",
      "Ada",
      "Fortran",
      "Matlab/Octave",
      "Lisp",
      "Prolog",
      "SPARC Assembly",
      "ESSI",
      "JavaScript",
      "R",
      "Perl",
      "SQL",
      "LaTeX",
      "DOT"
    ],
    "tools": [
      "Linux"
    ]
  },
  "Roboteam": {
    "langs": [],
    "tools": []
  },
  "Finnpos Systems Oy": {
    "langs": [],
    "tools": []
  },
  "Elektrobit Oyj": {
    "langs": [],
    "tools": []
  },
  "Nice-business Solutions Oy": {
    "langs": [],
    "tools": []
  },
  "Neter": {
    "langs": [],
    "tools": []
  },
  "Cybercom Finland Oy": {
    "langs": [],
    "tools": []
  }
};

const projects = {
  "Kurikan Ryhti homepages and TV ads": {
    "org": "Kurikan Kaupunki",
    "langs": [
      "JavaScript",
      "HTML/CSS"
    ],
    "tools": [
      "Powerpoint",
      "Windows"
    ]
  },
  "Programming courses for 10-14 year-olds": {
    "org": "Kurikan Kaupunki",
    "langs": [
      "Java",
      "HTML/CSS"
    ],
    "tools": [
      "Windows",
      "Applets"
    ]
  },
  "Eurobot": {
    "org": "Roboteam",
    "langs": [
      "C++",
      "Matlab/Octave",
      "LaTeX"
    ],
    "tools": [
      "Linux",
      "OpenCV"
    ]
  },
  "Robotic Bartender": {
    "org": "Roboteam",
    "langs": [
      "Rapid",
      "C++",
      "Matlab/Octave",
      "Linux"
    ],
    "tools": []
  },
  "Finnpos F2": {
    "org": "Finnpos Systems Oy",
    "langs": [
      "Dynamic C",
      "Perl",
      "HTML/CSS"
    ],
    "tools": [
      "CVS",
      "Subversion",
      "Linux"
    ]
  },
  "Finnpos F3": {
    "org": "Finnpos Systems Oy",
    "langs": [
      "Java"
    ],
    "tools": [
      "CVS",
      "Subversion",
      "NetBeans",
      "Linux"
    ]
  },
  "Linux driver, LG touchscreen": {
    "org": "Finnpos Systems Oy",
    "langs": [
      "C"
    ],
    "tools": [
      "CVS",
      "Subversion",
      "Linux"
    ]
  },
  "VoIP System": {
    "org": "Finnpos Systems Oy",
    "langs": [
      "C++",
      "Java"
    ],
    "tools": [
      "CVS",
      "Subversion",
      "Eclipse",
      "Linux",
      "Windows"
    ]
  },
  "Crypto infrastructure": {
    "org": "Finnpos Systems Oy",
    "langs": [
      "Java",
      "SQL",
      "LaTeX"
    ],
    "tools": [
      "CVS",
      "Subversion",
      "Eclipse",
      "Linux"
    ]
  },
  "Datamike billing/accounting": {
    "org": "Turvavartiointi M. Savela Ky",
    "langs": [
      "xBase"
    ],
    "tools": [
      "Windows"
    ]
  },
  "Rene RNC HSPA": {
    "org": "Elektrobit Oyj",
    "langs": [
      "C",
      "Python",
      "Perl",
      "LaTeX",
      "DOT"
    ],
    "tools": [
      "Subversion",
      "DSP",
      "OSEck",
      "Linux"
    ]
  },
  "Carbook": {
    "org": "Elektrobit Oyj",
    "langs": [
      "Java",
      "Python",
      "Perl",
      "Erlang",
      "RDF",
      "JavaScript",
      "SQL",
      "LaTeX"
    ],
    "tools": [
      "Subversion",
      "Glassfish",
      "MySQL",
      "Linux"
    ]
  },
  "Identity Federation": {
    "org": "Nice-business Solutions Oy",
    "langs": [
      "Perl",
      "Java",
      "Python",
      "HTML/CSS",
      "Ruby",
      "JavaScript"
    ],
    "tools": [
      "Subversion",
      "Tomcat",
      "MySQL"
    ]
  },
  "B2B Portal": {
    "org": "Nice-business Solutions Oy",
    "langs": [
      "Java",
      "Scala",
      "HTML/CSS",
      "JavaScript",
      "SQL"
    ],
    "tools": [
      "Subversion",
      "WebSphere",
      "Oracle"
    ]
  },
  "BPT": {
    "org": "Nice-business Solutions Oy",
    "langs": [
      "Java",
      "Scala",
      "HTML/CSS",
      "JavaScript",
      "SQL"
    ],
    "tools": [
      "Oracle",
      "WebSphere",
      "Subversion"
    ]
  },
  "Drupal CMS": {
    "org": "Nice-business Solutions Oy",
    "langs": [
      "HTML/CSS",
      "JavaScript",
      "PHP"
    ],
    "tools": [
      "Drupal",
      "Subversion",
      "Eclipse"
    ]
  },
  "Drupal concept app": {
    "org": "Cybercom Finland Oy",
    "langs": [
      "HTML/CSS",
      "JavaScript",
      "PHP"
    ],
    "tools": [
      "Git",
      "Drupal"
    ]
  },
  "EURA funds management": {
    "org": "Cybercom Finland Oy",
    "langs": [
      "Java",
      "Scala",
      "Groovy",
      "HTML/CSS",
      "JavaScript",
      "SQL"
    ],
    "tools": [
      "Git",
      "Eclipse",
      "Vagrant",
      "Chef",
      "Spring",
      "Wicket"
    ]
  },
  "Industrial calibration": {
    "org": "Cybercom Finland Oy",
    "langs": [
      "JavaScript",
      "TypeScript",
      "C",
      "Matlab/Octave"
    ],
    "tools": [
      "Mercurial",
      "Git",
      "Eclipse"
    ]
  },
  "Machinebook": {
    "org": "Cybercom Finland Oy",
    "langs": [
      "JavaScript",
      "LaTeX"
    ],
    "tools": [
      "Git",
      "Eclipse"
    ]
  },
  "Innovation Zone": {
    "org": "Cybercom Finland Oy",
    "langs": [
      "Java",
      "JavaScript",
      "Matlab/Octave",
      "UnityScript",
      "R",
      "SQL"
    ],
    "tools": [
      
    ]
  },
  "Oskari": {
    "org": "Cybercom Finland Oy",
    "langs": [
      "Java",
      "JavaScript",
      "SQL"
    ],
    "tools": [
      
    ]
  },
  "Suomi.fi": {
    "org": "Cybercom Finland Oy",
    "langs": [
      "Java",
      "JavaScript",
      "RDF",
      "SQL"
    ],
    "tools": [
      "Ansible",
      "Docker",
      "ElasticSearch",
      "React",
      "Angular",
      "Redis",
      "Jena",
      "Jira",
      "Confluence",
      "Vagrant"
    ]
  },
  "Presentations": {
    "org": "Cybercom Finland Oy",
    "langs": [
      "LaTeX",
      "DOT",
      "JavaScript",
      "Solidity",
      "Python"
    ],
    "tools": [
      
    ]
  },
  "Hacking competitions": {
    "org": "Cybercom Finland Oy",
    "langs": [
      "Python",
      "JavaScript",
      "HTML/CSS",
      "DOT"
    ],
    "tools": [
      "ElasticSearch",
      "Logstash",
      "Kibana"
    ]
  },
  "Advisory":  {
    "org": "Cybercom Finland Oy",
    "langs": [],
    "tools": [
      
    ]
  },
  "NFC Cordova app": {
    "org": "Neter",
    "langs": [
      "Java",
      "JavaScript"
    ],
    "tools": [
      "Cordova",
      "Android",
      "NFC"
    ]
  },
  "Therapeutic Phaser game": {
    "org": "Neter",
    "langs": [
      "JavaScript"
    ],
    "tools": [
      "Heroku"
    ]
  },
  "Research": {
    "org": "Neter",
    "langs": [
      "Python",
      "Lua",
      "Solidity",
      "LaTeX"
    ],
    "tools": [
      "OpenShift"
    ]
  }
};

const epochs = {
  "1989–1994": ["Kirkon Ala-aste"],
  "1995–2000": ["Kurikan Yläaste, Lukio", "Kurikan Kaupunki", "Turvavartiointi M. Savela Ky"],
  "2001–2008": ["Roboteam", "Finnpos Systems Oy", "Tampere University of Technology", "Elektrobit Oyj"],
  "2009–2012": ["Elektrobit Oyj", "Nice-business Solutions Oy", "Neter"],
  "2012–": ["Neter", "Cybercom Finland Oy"]
};

const timeline = ["1989–1994", "1995–2000", "2001–2008", "2009–2012", "2012–"];

const skills = [
  "3D modeling",
  "Tracker music",
  "Value Creation Canvas",
  "Full-stack",
  "Architecture",
  "Machine learning",
  "Artificial intelligence",
  "Deep learning",
  "Signal processing",
  "Mathematical modeling",
  "Cryptoalgorithms",
  "Blockchain",
  "Audio codecs",
  "Visa POS PED",
  ""
];

const tools = [
  "Docker",
  "Ansible",
  "Puppet",
  "Vagrant",
  "Git",
  "Subversion",
  "Mercurial",
  "CVS",
  "Confluence",
  "Jira",
  "Qt",
  "React",
  "Polymer",
  "Angular",
  "OSEck",
  "Linux",
  "Android",
  "Tensorflow",
  "CUDA",
  "Torch",
  "Jenkins",
  "Spring",
  "JavaEE",
  "Oracle",
  "MySQL",
  "PostgreSQL",
  "ElasticSearch",
  "MongoDB",
  "CouchDB",
  "Redis",
  "HBase",
  "WebSphere",
  "Tomcat",
  "Jetty",
  "node.js",
  "OpenGL",
  "WebGL",
  "Phaser",
  "Cordova",
  "Ionic",
  "Heroku",
  "AWS",
  "Google App Engine",
  "RedShift",
  "JRebel",
  "ScalaTest",
  "JUnit",
  "JMeter",
  "JSP",
  "CWiki",
  "OpenCV",
  "OpenLayers",
  "Velocity",
  "Wicket",
  "VmWare",
  "Jena",
  "XMPP",
  "Ejabberd",
  "GCC",
  "NFC"
];

let showLanguages = true, showOrgs = true, showProjects = true, showEpochs = true;

// Truly sorry about the messy code. This is just a hack. If I ever extend it further, I will redesign it.
// The point is that the domain information is given in a convenient fashion as above, and
// all the complexity is moved away from maintaining the information.

const oToP = Object.keys(projects).map(p => [projects[p].org, p]);
const fromOrgToProjects = new Map();
Object.keys(orgs).forEach(o => {
  fromOrgToProjects.set(o, []);
});
oToP.forEach(op => {
  fromOrgToProjects.get(op[0]).push(op[1]);
});

function getEpochConnections() {
  const pairwiseTimeline = [];
  for (let i = 1; i < timeline.length; i++) {
    pairwiseTimeline.push([timeline[i-1], timeline[i]]);
  }
  
  if (!showEpochs) {
    return [];
  } else if (showOrgs) {
    return Object.keys(epochs)
      .map(e => epochs[e].map(o => [e, o]))
      .reduce((x, y) => x.concat(y), [])
      .concat(pairwiseTimeline);
  } else if (showProjects) {
    const fromEpochsToOrgsToLangs = Object.keys(epochs).map(e => [... new Set(epochs[e].map(o => orgs[o].langs).reduce((x, y) => x.concat(y), [])
      .map(l => [l, e]))])
      .reduce((x, y) => x.concat(y), []);
    const fromEpochsToProjects = Object.keys(epochs)
      .map(e => [... new Set(epochs[e].map(o => fromOrgToProjects.get(o)).reduce((x, y) => x.concat(y), []).filter(p => p != null))]
      .map(p => [p, e]))
      .reduce((x, y) => x.concat(y), []);
    return fromEpochsToOrgsToLangs
      .concat(fromEpochsToProjects)
      .concat(pairwiseTimeline);
  } else if (showLanguages) {
    function langsForEpoch(e) {
      return [... new Set(
        epochs[e].map(o => fromOrgToProjects.get(o)).reduce((x, y) => x.concat(y), []).filter(p => p != null)
          .map(p => projects[p].langs).reduce((x, y) => x.concat(y), [])
        .concat(
            epochs[e].map(o => orgs[o].langs).reduce((x, y) => x.concat(y), [])
        )
      )].map(l => [l, e]);
    };
    const fromEpochsToLangs = Object.keys(epochs)
      .map(e => langsForEpoch(e))
      .reduce((x, y) => x.concat(y), []);
    return fromEpochsToLangs
      .concat(pairwiseTimeline);
  } else {
    return pairwiseTimeline;
  }
}

function getOrganizationConnections() {
  if (!showOrgs) {
    return [];
  }
  let languagesEdges = [];
  if (showLanguages) {
    languagesEdges = Object.keys(orgs)
      .map(o => orgs[o].langs.map(l => [l, o]))
      .reduce((x, y) => x.concat(y), []);
  }
  
  if (showProjects) {
    return languagesEdges.concat(Object.keys(projects).map(p => [projects[p].org, p]));
  } else if (showLanguages) {
    const projectEdges = Object.keys(orgs).map(o => [... new Set(fromOrgToProjects.get(o).filter(p => p != null).map(p => projects[p].langs)
      .reduce((x, y) => x.concat(y), []))]
      .map(l => [l, o])).reduce((x, y) => x.concat(y), []);
    return languagesEdges.concat(
      projectEdges);
  } else {
    return [];
  }
}

function getProjectConnections() {
  if (!showProjects) {
    return [];
  }
  if (showLanguages) {
    return Object.keys(projects).map(p => projects[p].langs.map(l => [l, p]))
      .reduce((x, y) => x.concat(y), [])
  } else {
    return [];
  }
}

function redraw() {
  showEpochs = $("#cbEpochs").is(":checked");
  showOrgs = $("#cbOrgs").is(":checked");
  showProjects = $("#cbProjects").is(":checked");
  showLanguages = $("#cbLanguages").is(":checked");
  
  const langNodes = [... new Set(
      Object.keys(orgs).map(o => orgs[o].langs).reduce((x, y) => x.concat(y), []).concat(
          Object.keys(projects).map(k => projects[k].langs).reduce((x, y) => x.concat(y), [])
      ).filter(_ => showLanguages)
    )];
    const orgNodes = Object.keys(orgs).filter(_ => showOrgs);
    const epochNodes = Object.keys(epochs).filter(_ => showEpochs);
    const projectNodes = Object.keys(projects).filter(_ => showProjects);
    
    const nodes =
      langNodes.map(l => ({id: l, label: l, group: 1})).concat(
      orgNodes.map(o => ({id: o, label: o, group: 2}))).concat(
      epochNodes.map(e => ({id: e, label: e, group: 3}))).concat(
      projectNodes.map(e => ({id: e, label: e, group: 4})));
    
    const edges = getOrganizationConnections()
      .concat(
        getEpochConnections()
      )
      .concat(
        getProjectConnections()
      );
    
    const visNodes = new vis.DataSet(nodes);
    const visEdges = new vis.DataSet(edges.map(e => ({from: e[0], to: e[1]})));
    // create a network
    const container = document.getElementById('vis');
    const data = {
      nodes: visNodes,
      edges: visEdges
    };
    const options = {};
    const network = new vis.Network(container, data, options);
    network.once('stabilized', function() {
      var scaleOption = { scale : 1.4 };
      network.moveTo(scaleOption);
    });
}

$(function() {
  redraw();
  $("#cbEpochs").change(() => {redraw();});
  $("#cbOrgs").change(() => {redraw();});
  $("#cbProjects").change(() => {redraw();});
  $("#cbLanguages").change(() => {redraw();});
});

</script>
<div style="height: 100%">
<h1>Timeline, Organizations, Projects, Programming languages</h1>
<p><a href="https://github.com/keskival/cv/raw/master/docs/cv_eng.pdf">CV</a></p>
<p><label><input type="checkbox" id="cbEpochs" checked />Epochs</label> 
<label><input type="checkbox" id="cbOrgs" checked />Organizations</label> 
<label><input type="checkbox" id="cbProjects" checked />Projects</label> 
<label><input type="checkbox" id="cbLanguages" checked />Languages</label> 
</p>
<div id="vis" style="height: 100%"></div>
</div>
</body>
</html>
